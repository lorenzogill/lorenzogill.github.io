name: Remove Markdown Files on Error

on:
  push:
    paths:
      - '**/*.md'

jobs:
  check_md:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Run Build Step (Jekyll or Other)
        id: build
        run: |
          # Jekyll 빌드를 실행하거나 Markdown 파일을 테스트하는 명령어 실행
          jekyll build

      - name: Check for Errors and Remove Files
        if: failure()
        run: |
          # 에러 로그에서 .md 파일 찾기
          error_files=$(grep -Eo '[^ ]+\.md' <(cat $GITHUB_WORKSPACE/_site/error.log))
          
          if [ -n "$error_files" ]; then
            for file in $error_files; do
              echo "Removing problematic file: $file"
              git rm "$file"
            done
            
            git config --global user.name "github-actions[bot]"
            git config --global user.email "github-actions[bot]@users.noreply.github.com"
            git add .
            git commit -m "Remove problematic markdown files based on error logs"
            git push
          else
            echo "No specific markdown file errors found."
          fi
